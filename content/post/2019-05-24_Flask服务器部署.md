---
title: "Flask服务器部署"
date: 2019-05-24T15:52:11+08:00
lastmod: 2019-05-24T15:52:11+08:00
draft: false
tags: ["Flask", "Python3", "部署"]
categories: ["后端"]
---

## 安装 Nginx

apt install nginx

## 基础环境安装

> 环境配置（云服务同时存在 python2，安装下列环境的时候均改为 pip3 install XXX）

-   Nginx
-   VirtualEnv
-   uwsgi
-   flask
    <!-- more -->

## 安装 VirtualEnv

```shell
pip3 install virtualenv
```

> 安装完 **virtualenv **后，进入自己的项目目录，通过 `virtualenv venv`（venv 可改为任意名字） 建立一个虚拟目录 **venv** ，然后 `source venv/bin/activate` 进入虚拟环境 SSH 终端开始多了   **(venv)**

```shell
pip3 install uwsgi
pip3 install flask
```

## 项目文件（例子）

```
from flask import Flask

app = Flask(__name__)

@app.route("/")
def index():
    return "Hello World!"

# 文件名 app.py
```

## Nginx 转发设置

```
server {
    charset      utf-8;
    listen       80;
    server_name  domain;
    root         /www/xxx/app;

    location / {
        include   uwsgi_params;
        uwsgi_pass   127.0.0.1:3000;
        uwsgi_param UWSGI_PYHOME /www/xxx/app/venv;
        uwsgi_param UWSGI_CHDIR  /www/xxx/app;
    }
}
```

`service nginx start` 启动 **nginx** 转发

## 配置 uwsgi

> touch uwsgi.ini 新建一个 ini 文件

### 配置文件内容

```
[uwsgi]
master = true
# venv 虚拟目录
home = /www/xxx/app/venv
# 项目文件
wsgi-file = app.py
# 应用的名字 app
callable = app
socket = 127.0.0.1:3000
stats = 127.0.0.1:9191
# 进程信息 进程数量
processes = 1
# 线程信息  线程数量
threads = 8
buffer-size=32768
# 存进程id的文件
pidfile=uwsgi.pid
# 日志文件
daemonize=uwsgi.log
```

`uwsgi --ini uwsgi.ini` 启动，`uwsgi --stop uwsgi.pid` 结束应用，`uwsgi --reload uwsgi.pid` 重载应用

打开 **domain** 就可以看到 **Hello World!** 了，说明部署成功
