---
title: 表达式计算
date: 2020-08-06 13:15:18
tags: [算法]
categories: [算法]
---

## 中缀转后缀步骤

1. 如果遇到操作数，直接将其输出
2. 如果遇到操作符，则放入栈中
    - **左括号也放入栈中**
3. 如果遇到右括号，则弹出操作符输出至左括号
4. 遇到其他操作符，从栈中弹出元素直到遇到**更低优先级**的操作符（更低级不弹出），然后将操作符压入栈中
    - 弹出过程中不会弹出左括号
5. 中缀**读取完成后**，依次弹出栈中元素
 <!-- more -->

## 算法

```python
def cal(exp):
    // 计算中缀表达式
    temp = list()
    operators = '+-*/'
    for item in exp:
        if item not in operators:
            temp.append(float(item))
        else:
            right = temp.pop()
            left = temp.pop()
            if item == '+':
                v = left + right
            elif item == '-':
                v = left - right
            elif item == '*':
                v = left * right
            elif item == '/':
                v = left / right
            temp.append(v)

    return temp.pop()


def infixToSuffix(exp):
    // 中缀转后缀
    operators = '+-*/()'
    priority = {
        '#': -1,
        '+': 0,
        '-': 0,
        '*': 1,
        '/': 1,
    }
    temp = list()
    op_stack = ['#']
    for item in exp:
        if item not in operators:
            temp.append(item)
        else:
            # print(op_stack)
            if item == ')':
                while op_stack[-1] != '(':
                    temp.append(op_stack.pop())
                op_stack.pop()
            elif item == '(' or op_stack[-1] == '(':
                op_stack.append(item)
            else:
                last = op_stack[-1]
                while last != '#' and priority[last] >= priority[item]:
                    temp.append(op_stack.pop())
                    last = op_stack[-1]
                op_stack.append(item)
    last = op_stack[-1]
    while last != '#':
        temp.append(op_stack.pop())
        last = op_stack[-1]
    return ' '.join(temp)


if __name__ == '__main__':
    suffix = '3 5 - 6 17 4 * + * 3 /'
    infix = '( 3 - 5 ) * ( 6 + 17 * 4 ) / 3'
    print(infix)
    infix = infix.split()
    suffix = infixToSuffix(infix)
    print(suffix)
    res = cal(suffix.split())
    print(res)
```
