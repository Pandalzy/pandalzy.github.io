---
title: vue 组件
date: 2020-08-07 19:35:12
tags: [Vue]
categories: [前端]
---

## 组件

### 全局注册

```html
<div id="app">
    <my-component></my-component>
</div>

<script>
    Vue.component("my-component", {
        template: "<div>这里是组件内容</div>",
    });
    var app = new Vue({
        el: "#app",
    });
</script>
```

> template 中的内容必须带 html 标签

<!-- more -->

### 局部注册

```html
<div id="app">
    <my-component></my-component>
</div>

<script>
    let child = {
        template: "<div>这里是组件内容</div>",
    };
    var app = new Vue({
        el: "#app",
        components: {
            "my-component": child,
        },
    });
</script>
```

### is 挂载组件

`<table>`中只能是`<tr>`、`<td>` 、`<th>`等这些表格元素，所以在`<table>`内直接使用组件是无效的。

```html
<div id="app">
    <table>
        <tbody is="my-component"></tbody>
    </table>
</div>

<script>
    Vue.component("my-component", {
        template: "<div>这里是组件内容</div>",
    });
    var app = new Vue({
        el: "#app",
    });
</script>
```

使用 is 挂载，tbody 会被替换成组件内容

## 使用 props 传递数据

### 基本使用

```html
<div id="app">
    <my-component message="要传给组件的消息"></my-component>
</div>

<script>
    Vue.component("my-component", {
        props: ["message"],
        template: "<div>{{message}}</div>",
    });
    var app = new Vue({
        el: "#app",
    });
</script>
```

HTML 特性不区分大小写，驼峰命名（camelCase）的 props 需要转为短横分割（kebab-case）

```html
<my-component msg-text="要传给组件的消息"></my-component> props: ['msgText']
```

### 单向数据流

```html
<div id="app">
    <my-component message="要传给组件的消息" :width="100"></my-component>
</div>
<script>
    Vue.component("my-component", {
        props: ["message", "width"],
        template: "<div>{{message}} {{style}}</div>",
        data() {
            return {
                msg: this.message,
            };
        },
        computed: {
            style: function () {
                return "width:" + this.width + "px";
            },
        },
    });
    var app = new Vue({
        el: "#app",
    });
</script>
```

### 数据验证

```javascript
porps: {
    propA: Number,
    propB: [String, Number],
    propC: {
        type: Boolean,
        default: true
    },
    propD: {
        type: Number,
        require: true
    },
    // 对象或数组函数返回
    propE: {
        type: Array,
        default: function () {
            return []
        }
    },
    // 自定义一个验证函数
    propF: {
        validator: function (value) {
            return value > 10
        }
    },
}
```

## 组件通信

### 自定义事件

子组件用`$emit()`来触发事件，父组件用`$on()`来监听子组件的事件

```html
<div id="app">
    <p>总数：{{total}}</p>
    <my-comp @inc="handleGetTotal" @dec="handleGetTotal"></my-comp>
</div>
<script>
    Vue.component("my-comp", {
        template: "\
            <div>\
                <button @click='handleInc'>+1</button>\
                <button @click='handleDec'>-1</button>\
    		</div>",
        data() {
            return {
                counter: 0,
            };
        },
        methods: {
            handleInc: function () {
                this.counter++;
                this.$emit("inc", this.counter);
            },
            handleDec: function () {
                this.counter--;
                this.$emit("dec", this.counter);
            },
        },
    });
    let app = new Vue({
        el: "#app",
        data: {
            total: 0,
        },
        methods: {
            handleGetTotal: function (total) {
                this.total = total;
            },
        },
    });
</script>
```

### 非父子组件通信

使用一个空的 Vue 实例作为中央事件总线（bus），也就是一个中介。

```html
<div id="app">
    {{msg}}
    <my-comp></my-comp>
</div>
<script>
    let bus = new Vue();

    Vue.component("my-comp", {
        template: "<button @click='handleEvent'>传递事件</button>",
        methods: {
            handleEvent: function () {
                bus.$emit("on-msg", "来自组件的内容");
            },
        },
    });
    let app = new Vue({
        el: "#app",
        data: {
            msg: "",
        },
        mounted() {
            let that = this;
            bus.$on("on-msg", function (msg) {
                that.msg = msg;
            });
        },
    });
</script>
```

## 使用 slot 分发内容

### slot 用法

#### 单个 slot

```html
<div id="app">
    <my-comp>
        <!-- 将渲染p标签 -->
        <p>分发更多内容</p>
        <p>分发内容</p>
    </my-comp>
</div>
<script>
    Vue.component("my-comp", {
        template: "\
        <div>\
            <slot>默认消息</slot>\
        </div>",
    });
    let app = new Vue({
        el: "#app",
    });
</script>
```

#### 多个 slot

```html
<div id="app">
    <my-comp>
        <h2 slot="header">标题</h2>
        <p>正文内容</p>
        <p>更多内容</p>
        <div slot="footer">底部消息</div>
    </my-comp>
</div>

<script>
    Vue.component("my-comp", {
        template: "\
        <div>\
            <div class='header'>\
                <slot name='header'></slot>\
            </div>\
            <div class='main'>\
                <slot></slot>\
            </div>\
            <div class='footer'>\
                <slot name='footer'></slot>\
            </div>\
        </div>",
    });
    let app = new Vue({
        el: "#app",
    });
</script>
```

### 作用于插槽

```html
<div id="app">
    <my-comp>
        <template slot-scope="props">
            <p>正文内容</p>
            <p>{{props.msg}}</p>
        </template>
    </my-comp>
</div>

<script>
    Vue.component("my-comp", {
        template: "\
        <div>\
            <slot msg='来自子组件的消息'></slot>\
        </div>",
    });
    let app = new Vue({
        el: "#app",
    });
</script>
```

## 组件高级用法

### 递归组件

递归调用自己，需要给组件设置 name 选项

```html
<div id="app">
    <my-comp :count="1"></my-comp>
</div>
<script>
    Vue.component("my-comp", {
        name: "my-comp",
        props: {
            count: {
                type: Number,
                default: 1,
            },
        },
        template: "\
        <div>\
            {{count}}\
            <my-comp :count='count + 1' v-if='count < 3'>\
            </my-comp>\
        </div>",
    });
    let app = new Vue({
        el: "#app",
    });
</script>
```

### 内联模板

```html
<my-comp inline-template></my-comp>
```

### 动态组件

```html
<div id="app">
    <component :is="currentView"></component>
    <button @click="change('A')">A</button>
    <button @click="change('B')">B</button>
</div>
<script>
    let app = new Vue({
        el: "#app",
        components: {
            A: {
                template: "<div>组件A</div>",
            },
            B: {
                template: "<div>组件B</div>",
            },
        },
        data: {
            currentView: "A",
        },
        methods: {
            change: function (com) {
                this.currentView = com;
            },
        },
    });
</script>
```

### 异步组件

```html
<div id="app">
    <my-comp></my-comp>
</div>
<script>
    Vue.component("my-comp", function (resolve, reject) {
        window.setTimeout(function () {
            resolve({
                template: "<div>异步渲染</div>",
            });
        }, 2000);
    });
    let app = new Vue({
        el: "#app",
    });
</script>
```

工厂函数，接受一个 resolve 回调，在收到从服务器下载组件定义时调用

## 其他

### \$nextTick

\$nextTick 用来知道什么时候 DOM 更新完成

```javascript
this.show = true;
this.$nextTick(function () {
    let text = document.getElementById("div").innerHTML;
    console.log(text);
});
```

### X-Templates

```javascript
<script type="text/x-template" id="my-comp">
    <div></div>
</script>;
Vue.component("my-comp", {
    template: "#my-comp",
});
```
