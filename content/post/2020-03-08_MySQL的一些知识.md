---
title: MySQL的一些知识
date: 2020-03-08 22:17:28
tags: [msyql, "服务端"]
categories: ["知识点"]
---

## ubuntu 重装 mysql

### 删除 mysql

```shell
sudo apt purge mysql-*
sudo rm -rf /etc/mysql/ /var/lib/mysql
sudo apt autoremove
sudo apt autoreclean
```

<!-- more -->

### 安装 mysql

```shell
sudo apt install mysql-server
sudo apt install mysql-client
sudo apt install libmysqlclient-dev
```

> 期间会要求输入密码

```shell
sudo netstat -tap | grep mysql
# 查看mysql是否启动成功
```

![](https://raw.githubusercontent.com/Pandalzy/cloud_img/master/img/blog20200308222639.png)

## mysql 开启远程连接

-   root 登录 mysql

```shell
mysql -u root -p
```

-   给用户添加权限——改表法

```shell
use mysql;
update user set host='%' where user='username';
```

-   给用户添加权限——授权法

```shell
grant all privileges on *.* to 'username'@'%' with grant option;
# grant 权限1,权限2,…权限n on 数据库名.表名 to '用户名'@'用户地址';
flush privilege; # 刷新权限
quit
# 或者exit
# 或者ctrl+z

# *.*指数所有据库的所有表
# %为使所有IP都可以访问，
# with grant option 此用户情况下可以将此用户的权限给其他用户
```

-   修改 mysql 配置文件

```shell
sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf
# bind-address = 127.0.0.1
# 修改为
# bind-address = 127.0.0.1(前面加#)
# 或者
bind-address = 0.0.0.0
```

![](https://raw.githubusercontent.com/Pandalzy/cloud_img/master/img/blog20200308224705.png)

-   重启 mysql

```shell
service mysql restart
```

-   开放 3306 端口

    -   服务器需要配置安全组规则，有防火墙需要开放 3306

```shell
sudo ufw allow 3306
```

## 创建用户与授权

-   进入到 mysql 数据库下

```shell
use mysql;
```

-   对新用户增删改

```shell
# 创建用户:
# 指定ip：192.168.1.1的用户
create user 'username'@'192.168.1.1' identified by 'password';
# 指定ip：192.168.1.开头的用户
create user 'username'@'192.168.1.%' identified by 'password';
# 指定任何ip的用户
create user 'username'@'%' identified by '123';

# 删除用户
drop user '用户名'@'IP地址';

# 修改用户
rename user '用户名'@'IP地址' to '新用户名'@'IP地址';

# 修改密码
set password for '用户名'@'IP地址'=Password('newpassword');
```

-   用户授权管理

```shell
# 查看权限
show grants for '用户'@'IP地址'

# 授权用户仅对db1.t1文件有查询、插入和更新的操作
grant select,insert,update on db1.t1 to 'username'@'%';

# 授予用户db1.t1中全部权限
grant all privileges on db1.t1 to 'username'@'%';
# 授予用户db1中表全部权限
grant all privileges on db1.* to 'username'@'%';
# 授予用户所有数据库的所有表全部权限
grant all privileges on *.*  to 'username'@'%';

#取消权限

# 取消用户对db1.t1表全部权限
revoke all on db1.t1 from 'username'@"%";
# 取消用户对数据库db1的所有表的所有权限
revoke all on db1.* from 'username'@"%";
# 取消用户所有数据库的所有的表的权限
revoke all privileges on *.* from 'username'@'%';
```

## mysql 重置密码

> 只有 Debian 或 Ubuntu 服务器才有 debian-sys-maint 用户

-   打开 debian.cnf 文件

```shell
sudo vim /etc/mysql/debian.cnf
```

![](https://raw.githubusercontent.com/Pandalzy/cloud_img/master/img/blog20200308231718.png)

-   使用文件中的用户名和密码进入 mysql

```shell
mysql -u debian-sys-maint -p
```

-   选择 mysql 数据库

```shell
use mysql;
```

-   修改密码

```shell
update user set authentication_string=password('newpassword') where user='root';
```

-   退出

```shell
exit
```

-   重启 mysql

```shell
service mysql restart
```

## 一些常用命令

### 建表

```shell
create database if not exists test_db default character set utf8mb4 default collate utf8mb4_0900_ai_ci;
```
