<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Java Web初探 - Even - A super concise theme for Hugo</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="zyuanlee"><meta name=description content="01-Servlet基础 servlet 什么是servlet 运行在Servlet容器/Web应用服务/Tomcat，负责与客户端进行通信 servlet功能"><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.85.0 with theme even"><link rel=canonical href=http://localhost:1313/post/2020-11-14_java-web/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Java Web初探"><meta property="og:description" content="01-Servlet基础 servlet 什么是servlet 运行在Servlet容器/Web应用服务/Tomcat，负责与客户端进行通信 servlet功能"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/post/2020-11-14_java-web/"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-11-14T21:33:03+00:00"><meta property="article:modified_time" content="2020-11-14T21:33:03+00:00"><meta itemprop=name content="Java Web初探"><meta itemprop=description content="01-Servlet基础 servlet 什么是servlet 运行在Servlet容器/Web应用服务/Tomcat，负责与客户端进行通信 servlet功能"><meta itemprop=datePublished content="2020-11-14T21:33:03+00:00"><meta itemprop=dateModified content="2020-11-14T21:33:03+00:00"><meta itemprop=wordCount content="5257"><meta itemprop=keywords content="Java Web,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Java Web初探"><meta name=twitter:description content="01-Servlet基础 servlet 什么是servlet 运行在Servlet容器/Web应用服务/Tomcat，负责与客户端进行通信 servlet功能"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Blog</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Blog</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Java Web初探</h1><div class=post-meta><span class=post-time>2020-11-14</span><div class=post-category><a href=/categories/%E5%90%8E%E7%AB%AF/>后端</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#01-servlet基础>01-Servlet基础</a><ul><li><a href=#servlet>servlet</a></li><li><a href=#req与res>req与res</a></li><li><a href=#servlet生命周期>servlet生命周期</a></li><li><a href=#servlet层次结构>Servlet层次结构</a></li><li><a href=#httpservlet>HttpServlet</a></li></ul></li><li><a href=#02-jsp基础>02-JSP基础</a><ul><li><a href=#jsp的9个内置对象>jsp的9个内置对象</a></li></ul></li><li><a href=#03-jsp内置对象作用域>03-JSP内置对象作用域</a><ul><li><a href=#作用域>作用域</a></li><li><a href=#el表达式>EL表达式</a></li><li><a href=#jstl>JSTL</a></li></ul></li><li><a href=#04-过滤器>04-过滤器</a><ul><li><a href=#filter生命周期>filter生命周期</a></li></ul></li><li><a href=#05-文件上传下载>05-文件上传下载</a><ul><li><a href=#上传>上传</a></li><li><a href=#下载>下载</a></li></ul></li><li><a href=#06-异步ajax请求>06-异步Ajax请求</a></li><li><a href=#07-jdbc>07-JDBC</a><ul><li><a href=#jdbc体系结构>JDBC体系结构</a></li><li><a href=#jdbc使用>JDBC使用</a></li></ul></li><li><a href=#08-数据库连接池>08-数据库连接池</a><ul><li><a href=#数据库连接池实现>数据库连接池实现</a></li></ul></li><li><a href=#09-dbutils>09-DBUtils</a></li></ul></li></ul></nav></div></div><div class=post-content><h2 id=01-servlet基础>01-Servlet基础</h2><h3 id=servlet>servlet</h3><ul><li>什么是servlet<ul><li>运行在Servlet容器/Web应用服务/Tomcat，负责与客户端进行通信</li></ul></li><li>servlet功能<ul><li>创建并返回基于客户请求的动态HTML页面</li><li>与数据库进行通信</li></ul></li><li>如何使用<ul><li>servlet本身是一组接口，自定义一个类，并且实现servlet接口，这个类就具备接受客户端请求以及做出响应的功能。</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kn>package</span> <span class=nn>com.iot.servlet</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>javax.servlet.*</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyServlet</span> <span class=kd>implements</span> <span class=n>Servlet</span> <span class=o>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>init</span><span class=o>(</span><span class=n>ServletConfig</span> <span class=n>var1</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span> <span class=o>{}</span>
    
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>ServletConfig</span> <span class=nf>getServletConfig</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
    <span class=o>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>res</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;我是servlet&#34;</span><span class=o>);</span>
    <span class=o>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getServletInfo</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
    <span class=o>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>destroy</span><span class=o>()</span> <span class=o>{}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>浏览器不知能直接访问servlet，需要配置映射访问</p><ul><li><p>基于xml映射（web.xml）</p></li><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-xml data-lang=xml><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class=nt>&lt;web-app</span> <span class=na>xmlns=</span><span class=s>&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
         <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&#34;</span>
         <span class=na>version=</span><span class=s>&#34;4.0&#34;</span><span class=nt>&gt;</span>
    <span class=nt>&lt;servlet&gt;</span>
        <span class=nt>&lt;servlet-name&gt;</span>myservlet<span class=nt>&lt;/servlet-name&gt;</span>
        <span class=nt>&lt;servlet-class&gt;</span>com.iot.servlet.MyServlet<span class=nt>&lt;/servlet-class&gt;</span>
    <span class=nt>&lt;/servlet&gt;</span>
    <span class=nt>&lt;servlet-mapping&gt;</span>
        <span class=nt>&lt;servlet-name&gt;</span>myservlet<span class=nt>&lt;/servlet-name&gt;</span>
        <span class=nt>&lt;url-pattern&gt;</span>/myservlet<span class=nt>&lt;/url-pattern&gt;</span>
    <span class=nt>&lt;/servlet-mapping&gt;</span>
<span class=nt>&lt;/web-app&gt;</span>
</code></pre></td></tr></table></div></div></li><li><p>基于注解</p></li><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-jaVA data-lang=jaVA><span class=nd>@WebServlet</span><span class=o>(</span><span class=s>&#34;/myservlet&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyServlet</span> <span class=kd>implements</span> <span class=n>Servlet</span> <span class=o>{}</span>
</code></pre></td></tr></table></div></div></li></ul><h3 id=req与res>req与res</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Override</span>
<span class=kd>public</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>res</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;我是servlet&#34;</span><span class=o>);</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=乱码问题>乱码问题</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Override</span>
<span class=kd>public</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>res</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
    <span class=n>req</span><span class=o>.</span><span class=na>setCharacterEncoding</span><span class=o>(</span><span class=s>&#34;UTF-8&#34;</span><span class=o>);</span>  <span class=c1>// 请求中文
</span><span class=c1></span>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;我是servlet&#34;</span><span class=o>);</span>
    <span class=n>res</span><span class=o>.</span><span class=na>setContentType</span><span class=o>(</span><span class=s>&#34;text/html;charset=UTF-8&#34;</span><span class=o>);</span>  <span class=c1>// 响应中文
</span><span class=c1></span>    <span class=n>res</span><span class=o>.</span><span class=na>getWriter</span><span class=o>().</span><span class=na>write</span><span class=o>(</span><span class=s>&#34;哈哈&#34;</span><span class=o>);</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h3 id=servlet生命周期>servlet生命周期</h3><ol><li>当浏览器访问Servlet的时候，Tomcat 会查询当前Servlet的实例化对象是否存在，如果不存在，则通过反射机制动态创建对象。如果存在，直接执行第3步。</li><li>调用init完成初始化。<ol><li>ServletConfig：用来描述Servlet的基本信息</li><li>getServletName() 返回servlet的名称，全类名（带包名）。</li><li>getInitParameter(String key) 获取init参数（web.xml中配置）。</li><li>getInitParameterNames() 返回所有initParameter的name值。</li><li>getServletContext() 返回ServletContext对象，它是Servlet的上下文，整个Servlet的管理者。</li></ol></li><li>调用service完成业务逻辑操作（可以多次调用）。</li><li>关闭tomcat会调用destroy方法，释放资源。</li></ol><h3 id=servlet层次结构>Servlet层次结构</h3><p>Servlet->GenericServlet->HttpServlet</p><h3 id=httpservlet>HttpServlet</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@WebServlet</span><span class=o>(</span><span class=s>&#34;/demo1&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyServlet</span> <span class=kd>extends</span> <span class=n>HttpServlet</span> <span class=o>{</span>
    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doGet</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>resp</span><span class=o>.</span><span class=na>setContentType</span><span class=o>(</span><span class=s>&#34;text/html;charset=UTF-8&#34;</span><span class=o>);</span>
        <span class=n>resp</span><span class=o>.</span><span class=na>getWriter</span><span class=o>().</span><span class=na>write</span><span class=o>(</span><span class=s>&#34;哈哈&#34;</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h2 id=02-jsp基础>02-JSP基础</h2><p>JSP本质上是一个Servlet，JSP主要负责与用户交互，将最终的界面呈现给用户，HTML+JS+CSS+Java的混合文件。</p><p>当服务器接收到一个jsp请求时，将该请求交给jsp引擎去处理，每一个jsp页面第一次被访问的时候，jsp引擎会将他翻译成一个servlet文件，再由web容器调用servlet完成响应。</p><p>具体嵌入方式中：</p><ol><li>jsp脚本，执行Java逻辑代码</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;%
    System.out.println(test());
%&gt;
</code></pre></td></tr></table></div></div><ol start=2><li>jsp声明，定义Java方法</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;%!
    public String test(){
        return &#34;Hello&#34;;    
    }
%&gt;
</code></pre></td></tr></table></div></div><ol start=3><li>jsp表达式，把Java对象直接输出到HTML页面中</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;%=Java表达式%&gt;
</code></pre></td></tr></table></div></div><h3 id=jsp的9个内置对象>jsp的9个内置对象</h3><ol><li><strong>request</strong>：表示一次请求，HttpServletRequest</li><li><strong>response</strong>：表示一次响应，HttpServletResponse</li><li><strong>pageContext</strong>：页面上下文，获取页面信息，PageContext</li><li><strong>session</strong>：表示一次会话，保存用户信息，HttpSession</li><li><strong>application</strong>：当前web应用，全局对象，保存所有用户的共享信息，ServletContext</li><li>config：当前jsp对应的Servlet的ServletConfig对象，获取当前Servlet信息</li><li>out：向浏览器输出数据，JspWriter</li><li>page：当前jsp对应的Servlet，Servlet</li><li>exception：jsp页面发生的异常，Exception</li></ol><h4 id=request常用方法>request常用方法</h4><ol><li><code>String getParameter(String key)</code>：获取客户端传来的参数</li><li><code>void setAttribute(String key, Object value)</code>：通过键值对的形式保存数据</li><li><code>Object getAttribute(String key)</code>：通过key取出value</li><li><code>RequestDispatcher getRequestDispatcher(String path)</code>：返回一个对象，该对象的forward用于转发请求（服务端跳转）</li><li><code>String[] getParameterValues()</code>：获取客户端传来的多个同名参数</li><li><code>void setCharacterEncoding(String charse)</code>：指定每个请求的编码</li></ol><h4 id=response常用方法>response常用方法</h4><ol><li><code>sendRedirect(String path)</code>：重定向，页面之间的跳转（客户端跳转）</li></ol><h4 id=session>session</h4><ul><li>实现会话两种方法<ul><li>session</li><li>cookie</li></ul></li></ul><h4 id=session常用方法>session常用方法</h4><ul><li><p><code>String getId()</code>：获取sessionID</p></li><li><p><code>void setMaxInactiveInterval(int interval)</code>：设置session失效时间，单位为秒</p></li><li><p><code>int getMaxInactiveInterval()</code>：获取失效时间</p></li><li><p><code>void invalidate()</code>：设置session立即失效</p></li><li><p><code>void setAttribute(String key, Object value)</code></p></li><li><p><code>Object getAttribute(String key)</code></p></li><li><p><code>void removeAttribute(String key)</code></p></li></ul><h4 id=cookie>cookie</h4><p>服务端在HTTP响应中附带传给浏览器的一个小文本文件，一旦浏览器保存了某个cookie，在之后的请求和响应中，会将此cookie来回传递，这样就可以通过cookie这个载体完成客户端和服务端的数据交互。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Cookie</span> <span class=n>cookie</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Cookie</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>,</span><span class=s>&#34;zhangsan&#34;</span><span class=o>);</span>
<span class=n>response</span><span class=o>.</span><span class=na>addCookie</span><span class=o>(</span><span class=n>cookie</span><span class=o>);</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;%
    Cookie[] cookies = request.getCookies();
    for (Cookie cookie : cookies) {
        System.out.print(cookie.getName() + &#34;=&#34;);
        System.out.println(cookie.getValue());
    }
%&gt;
</code></pre></td></tr></table></div></div><h4 id=cookie常用方法>cookie常用方法</h4><ul><li>void setMaxAge(int age)：设置有效时间，单位为秒</li><li>int getMaxAge()：获取有效时间，默认为-1</li><li>String getName()：获取name</li><li>String getValue()：获取value</li></ul><h4 id=session和cookie区别>session和cookie区别</h4><ul><li>session<ul><li>保存在服务器</li><li>保存的数据是object</li><li>会随着会话的结束而销毁</li><li>保存重要信息</li></ul></li><li>cookie<ul><li>保存在浏览器</li><li>保存的数据是String</li><li>可以长期保存，与会话无关</li><li>保存不重要信息</li></ul></li></ul><h2 id=03-jsp内置对象作用域>03-JSP内置对象作用域</h2><h3 id=作用域>作用域</h3><p>page&lt;request&lt;session&lt;application</p><p>page只在当前页面有效</p><p>request在一次请求中有效</p><p>session在一次会话中有效</p><p>application对应整个web应用</p><h3 id=el表达式>EL表达式</h3><p>Expression Language表达式，替代JSP页面中数据访问时的复代码，<code>${表达式}</code></p><p>可以非常便捷的取出域对象（pageContext、request、session、application）中保存的数据，前提是一定要先setAttribute</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;%
    request.setAttribute(&#34;pk&#34;,&#34;123&#34;);
%&gt;
${pk}
</code></pre></td></tr></table></div></div><ul><li>EL对4钟域对象的默认查找顺序：pageContext->request->session->application，找到立即返回</li><li>指定作用域查找：<ul><li>pageContext：<code>${pageScope.name}</code></li><li>request：<code>${requestScope.name}</code></li><li>session：<code>${sessionScope.name}</code></li><li>application：<code>${applicationScope.name}</code></li></ul></li></ul><h4 id=el执行表达式>EL执行表达式</h4><p>&&（and）、||（or）、!（not）、==（eq）、!=（ne）等</p><p>${empty test}，empty判断，长度0（String、集合）为ture</p><h3 id=jstl>JSTL</h3><p>JSP为开发者提供的一系列标签，可以完成一些逻辑处理。JSTL与EL结合使用，使代码简洁。</p><ul><li><p>JSTL使用</p><ul><li>导入jar包（jstl.jar、standard.jar）<a href=http://archive.apache.org/dist/jakarta/taglibs/standard/binaries/>下载地址</a></li><li>在JSP页面开始的地方引入，<code>&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %></code></li><li>在需要的地方使用</li></ul></li><li><p>优点</p><ul><li>提供了统一的标签</li><li>可以用于编写各种动态功能</li></ul></li><li><p>常用标签</p><ul><li>set、out、remove、catch</li></ul></li><li><p>set：向域对象（默认pageContext）添加数据</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;%
    xxx.setAttribute(k, v);
%&gt;
等价于
&lt;c:set var=&#34;name&#34; value=&#34;name&#34;&gt;&lt;/c:set&gt;
向request中添加
&lt;c:set var=&#34;name&#34; value=&#34;name&#34; scope=&#34;request&#34;&gt;&lt;/c:set&gt;
修改属性
&lt;c:set target=&#34;${user}&#34; property=&#34;name&#34; value=&#34;李四&#34;&gt;&lt;/c:set&gt;
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;c:out value=&#34;${name}&#34; default=&#34;未定义&#34;&gt;&lt;/c:out&gt;
</code></pre></td></tr></table></div></div><ul><li>catch：捕获异常</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;c:catch var=&#34;error&#34;&gt;
    &lt;%
        int a = 10/0;
    %&gt;
&lt;/c:catch&gt;
${error}
</code></pre></td></tr></table></div></div><ul><li>条件标签：if、choose-when</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;c:if test=&#34;${num1 &gt; num2}&#34;&gt;ok&lt;/c:if&gt;
无else
&lt;c:if test=&#34;${num1 &lt;= num2}&#34;&gt;fail&lt;/c:if&gt;

&lt;c:choose&gt;
    &lt;c:when test=&#34;${num1&gt;num2}&#34;&gt;1&lt;/c:when&gt;
    &lt;c:when test=&#34;${num1&lt;num2}&#34;&gt;2&lt;/c:when&gt;
    &lt;c:otherwise&gt;3&lt;/c:otherwise&gt;
&lt;/c:choose&gt;
</code></pre></td></tr></table></div></div><ul><li>迭代标签：forEach</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;c:forEach items=&#34;${list}&#34; var=&#34;user&#34;&gt;
    ${user.name}
&lt;/c:forEach&gt;

&lt;%--[2, 3]--%&gt;
&lt;c:forEach items=&#34;${list}&#34; var=&#34;user&#34; begin=&#34;2&#34; end=&#34;3&#34; step=&#34;1&#34;&gt;
    ${user.name}
&lt;/c:forEach&gt;

&lt;c:forEach items=&#34;${list}&#34; var=&#34;user&#34; varStatus=&#34;sta&#34;&gt;
    ${sta.index}-${user.name}
&lt;/c:forEach&gt;
</code></pre></td></tr></table></div></div><ul><li>格式化标签库常用的标签：时间格式化、格式化数字</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;%@ taglib prefix=&#34;fmt&#34; uri=&#34;http://java.sun.com/jsp/jstl/fmt&#34; %&gt;

&lt;%
    request.setAttribute(&#34;date&#34;, new Date());
%&gt;
&lt;fmt:formatDate value=&#34;${date}&#34; pattern=&#34;YYYY-mm-dd hh:mm:ss&#34;&gt;&lt;/fmt:formatDate&gt;

&lt;fmt:formatNumber value=&#34;1234.567&#34; maxIntegerDigits=&#34;2&#34; maxFractionDigits=&#34;2&#34;&gt;&lt;/fmt:formatNumber&gt;
&lt;%--34.57--%&gt;
</code></pre></td></tr></table></div></div><ul><li>函数标签库常用的标签：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;%@ taglib prefix=&#34;fn&#34; uri=&#34;http://java.sun.com/jsp/jstl/functions&#34; %&gt;

&lt;%
    request.setAttribute(&#34;info&#34;, &#34;Java,C&#34;);
%&gt;
${fn:contains(info, &#34;python&#34;)}  &lt;%-- false --%&gt;
${fn:startsWith(info, &#34;Java&#34;)}  &lt;%-- true --%&gt;
${fn:indexOf(info, &#34;va&#34;)}  &lt;%-- 2 --%&gt;
</code></pre></td></tr></table></div></div><h2 id=04-过滤器>04-过滤器</h2><ul><li>功能<ul><li>用来拦截传入的请求和传出的响应</li><li>修改或以某种方式处理正在客户端和服务端之间交换的数据流</li></ul></li><li>如何使用<ul><li>与使用Servlet类似，Filter是java web提供的一个接口，只需定义一个类并且实现该接口。</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kn>package</span> <span class=nn>com.iot.filter</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>javax.servlet.*</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>CharacterFilter</span> <span class=kd>implements</span> <span class=n>Filter</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>doFilter</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>res</span><span class=o>,</span> <span class=n>FilterChain</span> <span class=n>fc</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>ServletException</span> <span class=o>{</span>
        <span class=n>req</span><span class=o>.</span><span class=na>setCharacterEncoding</span><span class=o>(</span><span class=s>&#34;utf-8&#34;</span><span class=o>);</span>
        <span class=n>res</span><span class=o>.</span><span class=na>setContentType</span><span class=o>(</span><span class=s>&#34;text/html;charset=UTF-8&#34;</span><span class=o>);</span>
        <span class=n>fc</span><span class=o>.</span><span class=na>doFilter</span><span class=o>(</span><span class=n>req</span><span class=o>,</span> <span class=n>res</span><span class=o>);</span>  <span class=c1>// 继续向后处理
</span><span class=c1></span>    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@WebServlet</span><span class=o>(</span><span class=s>&#34;/login&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>LoginServlet</span> <span class=kd>extends</span> <span class=n>HttpServlet</span> <span class=o>{</span>
    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doPost</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>username</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=na>getParameter</span><span class=o>(</span><span class=s>&#34;username&#34;</span><span class=o>);</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>username</span><span class=o>);</span>
        <span class=n>resp</span><span class=o>.</span><span class=na>getWriter</span><span class=o>().</span><span class=na>write</span><span class=o>(</span><span class=s>&#34;哈哈&#34;</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>web.xml配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;filter&gt;</span>
    <span class=nt>&lt;filter-name&gt;</span>charcater<span class=nt>&lt;/filter-name&gt;</span>
    <span class=nt>&lt;filter-class&gt;</span>com.iot.filter.CharacterFilter<span class=nt>&lt;/filter-class&gt;</span>
<span class=nt>&lt;/filter&gt;</span>
<span class=nt>&lt;filter-mapping&gt;</span>
    <span class=nt>&lt;filter-name&gt;</span>charcater<span class=nt>&lt;/filter-name&gt;</span>
    <span class=nt>&lt;url-pattern&gt;</span>/login<span class=nt>&lt;/url-pattern&gt;</span>
    <span class=nt>&lt;url-pattern&gt;</span>/test<span class=nt>&lt;/url-pattern&gt;</span>
<span class=nt>&lt;/filter-mapping&gt;</span>
</code></pre></td></tr></table></div></div><h3 id=filter生命周期>filter生命周期</h3><p>当配置多个filter时，根据在web.xml中的顺序来访问（注解@WebFilter不按顺序）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@WebFilter</span><span class=o>(</span><span class=s>&#34;/login&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>CharacterFilter</span> <span class=kd>implements</span> <span class=n>Filter</span> <span class=o>{}</span>
</code></pre></td></tr></table></div></div><ul><li>实际开发中filter使用场景<ul><li>统一处理中文乱码</li><li>屏蔽敏感词</li><li>控制资源访问权限</li></ul></li></ul><h2 id=05-文件上传下载>05-文件上传下载</h2><h3 id=上传>上传</h3><ul><li><p>JSP</p><ul><li>input的type设置为file</li><li>form表单的method设置为post，get只会传文件名</li><li>form的enctype设置为<code>multipart/form-data</code>，二进制传递数据</li></ul></li><li><p>servlet</p></li></ul><p>底层写法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Override</span>
<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doPost</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=o>{</span>
    <span class=c1>// 输入流获取客户端传来的数据
</span><span class=c1></span>    <span class=n>InputStream</span> <span class=n>inputStream</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>();</span>
    <span class=n>Reader</span> <span class=n>reader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InputStreamReader</span><span class=o>(</span><span class=n>inputStream</span><span class=o>);</span>
    <span class=n>BufferedReader</span> <span class=n>bufferedReader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedReader</span><span class=o>(</span><span class=n>reader</span><span class=o>);</span>

    <span class=c1>// 通过输出流将数据输出到本地
</span><span class=c1></span>    <span class=n>String</span> <span class=n>path</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=na>getServletContext</span><span class=o>().</span><span class=na>getRealPath</span><span class=o>(</span><span class=s>&#34;file/copy.txt&#34;</span><span class=o>);</span>
    <span class=n>OutputStream</span> <span class=n>outputStream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=n>path</span><span class=o>);</span>
    <span class=n>Writer</span> <span class=n>writer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OutputStreamWriter</span><span class=o>(</span><span class=n>outputStream</span><span class=o>);</span>
    <span class=n>BufferedWriter</span> <span class=n>bufferedWriter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BufferedWriter</span><span class=o>(</span><span class=n>writer</span><span class=o>);</span>
    <span class=n>String</span> <span class=n>str</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
    <span class=k>while</span> <span class=o>((</span><span class=n>str</span><span class=o>=</span><span class=n>bufferedReader</span><span class=o>.</span><span class=na>readLine</span><span class=o>())!=</span><span class=kc>null</span><span class=o>){</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>str</span><span class=o>);</span>
        <span class=n>bufferedWriter</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>str</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=n>bufferedWriter</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
    <span class=n>writer</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
    <span class=n>outputStream</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
    <span class=n>bufferedReader</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
    <span class=n>reader</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
    <span class=n>inputStream</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>FileUpload组件</p><p>可以将所有请求信息解析成FileItem对象，可以通过对FileItem对象操作完成上传，面向对象思想。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UploadServlet</span> <span class=kd>extends</span> <span class=n>HttpServlet</span> <span class=o>{</span>
    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doPost</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>DiskFileItemFactory</span> <span class=n>diskFileItemFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DiskFileItemFactory</span><span class=o>();</span>
        <span class=n>ServletFileUpload</span> <span class=n>servletFileUpload</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ServletFileUpload</span><span class=o>(</span><span class=n>diskFileItemFactory</span><span class=o>);</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=n>List</span><span class=o>&lt;</span><span class=n>FileItem</span><span class=o>&gt;</span> <span class=n>list</span> <span class=o>=</span> <span class=n>servletFileUpload</span><span class=o>.</span><span class=na>parseRequest</span><span class=o>(</span><span class=n>req</span><span class=o>);</span>
            <span class=k>for</span> <span class=o>(</span><span class=n>FileItem</span> <span class=n>fileItem</span> <span class=o>:</span> <span class=n>list</span><span class=o>)</span> <span class=o>{</span>
                <span class=k>if</span> <span class=o>(</span><span class=n>fileItem</span><span class=o>.</span><span class=na>isFormField</span><span class=o>())</span> <span class=o>{</span>
                    <span class=c1>// 表单文件
</span><span class=c1></span>                    <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>fileItem</span><span class=o>.</span><span class=na>getFieldName</span><span class=o>();</span>
                    <span class=n>String</span> <span class=n>value</span> <span class=o>=</span> <span class=n>fileItem</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=s>&#34;UTF-8&#34;</span><span class=o>);</span>
                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>name</span> <span class=o>+</span> <span class=s>&#34;: &#34;</span> <span class=o>+</span> <span class=n>value</span><span class=o>);</span>
                <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
                    <span class=n>String</span> <span class=n>fileName</span> <span class=o>=</span> <span class=n>fileItem</span><span class=o>.</span><span class=na>getName</span><span class=o>();</span>
                    <span class=kt>long</span> <span class=n>size</span> <span class=o>=</span> <span class=n>fileItem</span><span class=o>.</span><span class=na>getSize</span><span class=o>();</span>
                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>fileName</span> <span class=o>+</span> <span class=s>&#34;: &#34;</span> <span class=o>+</span> <span class=n>size</span> <span class=o>+</span> <span class=s>&#34;B&#34;</span><span class=o>);</span>
                    <span class=n>InputStream</span> <span class=n>inputStream</span> <span class=o>=</span> <span class=n>fileItem</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>();</span>
                    <span class=n>String</span> <span class=n>path</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=na>getServletContext</span><span class=o>().</span><span class=na>getRealPath</span><span class=o>(</span><span class=s>&#34;file/&#34;</span> <span class=o>+</span> <span class=n>fileName</span><span class=o>);</span>

                    <span class=n>OutputStream</span> <span class=n>outputStream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=n>path</span><span class=o>);</span>
                    <span class=kt>int</span> <span class=n>t</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>
                    <span class=k>while</span> <span class=o>((</span><span class=n>t</span> <span class=o>=</span> <span class=n>inputStream</span><span class=o>.</span><span class=na>read</span><span class=o>())</span> <span class=o>!=</span> <span class=o>-</span><span class=n>1</span><span class=o>)</span> <span class=o>{</span>
                        <span class=n>outputStream</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>t</span><span class=o>);</span>
                    <span class=o>}</span>
                    <span class=c1>// close
</span><span class=c1></span>                <span class=o>}</span>
            <span class=o>}</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>FileUploadException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h3 id=下载>下载</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@WebServlet</span><span class=o>(</span><span class=s>&#34;/download&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>DownloadServlet</span> <span class=kd>extends</span> <span class=n>HttpServlet</span> <span class=o>{</span>
    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doGet</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=o>{</span>
        <span class=c1>// 设置相应方式
</span><span class=c1></span>        <span class=n>resp</span><span class=o>.</span><span class=na>setContentType</span><span class=o>(</span><span class=s>&#34;application/x-msdownload&#34;</span><span class=o>);</span>
        <span class=n>String</span> <span class=n>filename</span> <span class=o>=</span> <span class=s>&#34;109.jpg&#34;</span><span class=o>;</span>
        <span class=c1>// 设置下载之后的文件名
</span><span class=c1></span>        <span class=n>resp</span><span class=o>.</span><span class=na>setHeader</span><span class=o>(</span><span class=s>&#34;Content-Disposition&#34;</span><span class=o>,</span> <span class=s>&#34;attachment;filename=&#34;</span> <span class=o>+</span> <span class=n>filename</span><span class=o>);</span>
        <span class=c1>// 获取输出流
</span><span class=c1></span>        <span class=n>OutputStream</span> <span class=n>outputStream</span> <span class=o>=</span> <span class=n>resp</span><span class=o>.</span><span class=na>getOutputStream</span><span class=o>();</span>

        <span class=n>String</span> <span class=n>path</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=na>getServletContext</span><span class=o>().</span><span class=na>getRealPath</span><span class=o>(</span><span class=s>&#34;file/&#34;</span> <span class=o>+</span> <span class=n>filename</span><span class=o>);</span>
        <span class=n>InputStream</span> <span class=n>inputStream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>path</span><span class=o>);</span>
        <span class=kt>int</span> <span class=n>t</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>
        <span class=k>while</span> <span class=o>((</span><span class=n>t</span> <span class=o>=</span> <span class=n>inputStream</span><span class=o>.</span><span class=na>read</span><span class=o>())</span> <span class=o>!=</span> <span class=o>-</span><span class=n>1</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>outputStream</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>t</span><span class=o>);</span>
        <span class=o>}</span>
        <span class=n>inputStream</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
        <span class=n>outputStream</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h2 id=06-异步ajax请求>06-异步Ajax请求</h2><p>Ajax是一种交互方式，异步加载，客户端和服务端的数据交互更新在局部页面的技术，不需要刷新整个页面</p><p>优点：</p><ol><li>局部刷新，效率更高</li><li>用户体验更好</li></ol><h2 id=07-jdbc>07-JDBC</h2><h3 id=jdbc体系结构>JDBC体系结构</h3><p>接口包括两个层面</p><ul><li>面向应用的API，供开发者调用（JDBC API）</li><li>面向数据库的API，供厂商开发数据库的驱动（JDBC Driver Manager）</li></ul><h4 id=jdbc-api>JDBC API</h4><p>java.sql和javax.sql</p><ul><li>DriverManager类</li><li>Connection接口</li><li>Statement接口</li><li>ResultSet接口</li></ul><h4 id=driver-manager>Driver Manager</h4><p>管理不同的JDBC驱动，负责连接不同的数据库</p><h3 id=jdbc使用>JDBC使用</h3><ol><li>加载数据库驱动，Java程序和数据库之间的桥梁</li><li>获取Connection，Java程序与数据库的一次连接</li><li>创建Statement对象，由Connection产生，执行SQL语句</li><li>如果需要接受返回值，创建ResultSet对象，保存Statement执行之后的查询结果</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Test</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ClassNotFoundException</span><span class=o>,</span> <span class=n>SQLException</span> <span class=o>{</span>
        <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class=o>);</span>
        <span class=n>String</span> <span class=n>url</span> <span class=o>=</span> <span class=s>&#34;jdbc:mysql://xxxxx:3306/cumt_funding&#34;</span><span class=o>;</span>
        <span class=n>String</span> <span class=n>username</span> <span class=o>=</span> <span class=s>&#34;cumt_funding&#34;</span><span class=o>;</span>
        <span class=n>String</span> <span class=n>password</span> <span class=o>=</span> <span class=s>&#34;xxxxxxx&#34;</span><span class=o>;</span>
        <span class=n>Connection</span> <span class=n>connection</span> <span class=o>=</span> <span class=n>DriverManager</span><span class=o>.</span><span class=na>getConnection</span><span class=o>(</span><span class=n>url</span><span class=o>,</span> <span class=n>username</span><span class=o>,</span> <span class=n>password</span><span class=o>);</span>
        <span class=n>String</span> <span class=n>sql</span> <span class=o>=</span> <span class=s>&#34;insert into user(id, name, age) values(10, &#39;张三&#39;, 100)&#34;</span><span class=o>;</span>
        <span class=n>Statement</span> <span class=n>statement</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=na>createStatement</span><span class=o>();</span>
        <span class=n>statement</span><span class=o>.</span><span class=na>executeUpdate</span><span class=o>(</span><span class=n>sql</span><span class=o>);</span>
        <span class=n>statement</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
		<span class=n>connection</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h4 id=preparedstatement>PreparedStatement</h4><p>Statement的子类，提供了SQL占位符的功能。</p><ul><li>使用Statement开发问题<ul><li>需要频繁拼接String字符串，出错率高</li><li>存在SQL注入风险</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>Connection</span> <span class=n>connection</span> <span class=o>=</span> <span class=n>DriverManager</span><span class=o>.</span><span class=na>getConnection</span><span class=o>(</span><span class=n>url</span><span class=o>,</span> <span class=n>username</span><span class=o>,</span> <span class=n>password</span><span class=o>);</span>
<span class=n>String</span> <span class=n>sql</span> <span class=o>=</span> <span class=s>&#34;select * from user where username = ? and password = ?&#34;</span><span class=o>;</span>
<span class=n>PreparedStatement</span> <span class=n>preparedStatement</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=na>prepareStatement</span><span class=o>(</span><span class=n>sql</span><span class=o>);</span>
<span class=n>preparedStatement</span><span class=o>.</span><span class=na>setString</span><span class=o>(</span><span class=n>1</span><span class=o>,</span> <span class=s>&#34;zyuanlee&#34;</span><span class=o>);</span>
<span class=n>preparedStatement</span><span class=o>.</span><span class=na>setString</span><span class=o>(</span><span class=n>2</span><span class=o>,</span> <span class=s>&#34;123456&#34;</span><span class=o>);</span>
<span class=n>ResultSet</span> <span class=n>resultSet</span> <span class=o>=</span> <span class=n>preparedStatement</span><span class=o>.</span><span class=na>executeQuery</span><span class=o>();</span>
<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>resultSet</span><span class=o>);</span>
<span class=n>resultSet</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
<span class=n>preparedStatement</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
<span class=n>connection</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</code></pre></td></tr></table></div></div><h2 id=08-数据库连接池>08-数据库连接池</h2><p>JDBC开发流程</p><ul><li>加载驱动（只需加载一次）</li><li>建立数据库连接（Connection）</li><li>执行SQL（Statement）</li><li>ResultSet接受结果集（查询）</li><li>断开连接，释放资源</li></ul><p>数据库连接对象是通过DriverManager来获取的，每次都需要向数据库申请获取连接，验证用户名和密码，执行完SQL语句后断开连接，这样会造成资源浪费，使用数据库连接池解决。</p><p>数据库连接池的基本思想是为数据库建立一个缓冲池，预先向缓冲池中放入一定数量的连接对象，当需要获取数据库连接的时候，只需要从缓冲池中取出一个对象，用完之后再放回缓冲池中，供下一次请求使用。</p><p>当数据库连接池中没有空闲连接时，新的请求就会进入等待队列，等待其他线程释放资源。</p><h3 id=数据库连接池实现>数据库连接池实现</h3><p>javax.sql.DataSource，可以不自己实现该接口，使用第三方工具。</p><h2 id=09-dbutils>09-DBUtils</h2><p>完成数据封装（结果集到java对象的映射）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>String</span> <span class=n>sql</span> <span class=o>=</span> <span class=s>&#34;select * from student where id = 30&#34;</span><span class=o>;</span>
<span class=n>QueryRunner</span> <span class=n>queryRunner</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QueryRunner</span><span class=o>();</span>
<span class=n>student</span> <span class=o>=</span> <span class=n>queryRunner</span><span class=o>.</span><span class=na>query</span><span class=o>(</span><span class=n>connection</span><span class=o>,</span> <span class=n>sql</span><span class=o>,</span> <span class=k>new</span> <span class=n>BeanHanler</span><span class=o>&lt;&gt;(</span><span class=n>Student</span><span class=o>.</span><span class=na>class</span><span class=o>));</span>

<span class=n>String</span> <span class=n>sql</span> <span class=o>=</span> <span class=s>&#34;select * from student where id = ?&#34;</span><span class=o>;</span>
<span class=n>QueryRunner</span> <span class=n>queryRunner</span> <span class=o>=</span> <span class=k>new</span> <span class=n>QueryRunner</span><span class=o>();</span>
<span class=n>student</span> <span class=o>=</span> <span class=n>queryRunner</span><span class=o>.</span><span class=na>query</span><span class=o>(</span><span class=n>connection</span><span class=o>,</span> <span class=n>sql</span><span class=o>,</span> <span class=k>new</span> <span class=n>BeanHanler</span><span class=o>&lt;&gt;(</span><span class=n>Student</span><span class=o>.</span><span class=na>class</span><span class=o>),</span> <span class=n>id</span><span class=o>);</span>
</code></pre></td></tr></table></div></div><p>ResultHandler接口用来处理结果集，可以将查询到的结果转为java对象，提供了4钟实现类</p><ul><li>BeanHandler：将结果集映射为java对象（单条数据）</li><li>BeanListHandler：映射为List集合（多条数据）</li><li>MapHandler：映射为Map对象</li><li>MapListHandler：映射为MapList集合</li></ul></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>zyuanlee</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2020-11-14</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/java-web/>Java Web</a></div><nav class=post-nav><a class=prev href=/post/2021-04-09_celery-cannot-connect-to-amqp/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Celery Cannot connect to amqp</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/2020-08-11_django%E9%83%A8%E7%BD%B2uwsginginx%E9%85%8D%E7%BD%AE%E6%A8%A1%E6%9D%BF/><span class="next-text nav-default">Django部署：uwsgi、nginx配置模板</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=zyuanlee97@gmail.com class="iconfont icon-email" title=email></a><a href=https://github.com/Pandalzy class="iconfont icon-github" title=github></a><a href=http://localhost:1313/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2019 -
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>zyuanlee</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script></body></html>